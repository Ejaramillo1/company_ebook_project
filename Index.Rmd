---
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)


library(easypackages)
my_packages <- c("tidyverse", "readxl", "lubridate")
libraries(my_packages)


BIE_BIE20180126152150 <- read_excel("C:/Users/pvelazquez/Google Drive/Sector Industrial en Tijuana/Bases de datos/INDICADORES_ECONOMICOS_DE_COYUNTURA/BIE_BIE20180126152150.xlsx", 
                                    col_names = TRUE, skip = 1) %>%
  filter(!is.na(.[,2]))


datos <- BIE_BIE20180126152150 %>%
  rename_all(funs(str_to_lower(.) %>%
                    str_replace(., "proyectos especiales > tablero de indicadores económicos > ", ""))) %>%
  select(contains("construcción")) %>%
  rename( "constr_orig" = "indicadores de producción > índice de volumen físico de la construcción original p2 / f2/ (índice base 2013=100)", 
          "constr_calend" = "indicadores de producción > índice de volumen físico de la construcción original corregida por efectos de calendario f3/ (índice base 2013=100)", 
          "constr_esta" = "indicadores de producción > índice de volumen físico de la construcción desestacionalizada f3/ (índice base 2013=100)", 
          "constr_trend" = "indicadores de producción > índice de volumen físico de la construcción tendencia f3/ (índice base 2013=100)", 
          "constr_cicl" = "indicadores de producción > índice de volumen físico de la construcción ciclo f3/ (puntos)") %>%
  mutate(periodo = BIE_BIE20180126152150$Periodo,
         day = "01") %>%
  separate(periodo, into = c("year", "month"), sep = "\\/") %>%
  mutate(fecha = as_date(paste0(year, month, day))) %>%
  filter(fecha > "2007-01-01")


datos2 <- BIE_BIE20180126152150 %>%
  rename_all(funs(str_to_lower(.) %>%
                    str_replace(., "proyectos especiales > tablero de indicadores económicos > ", ""))) %>%
  select(contains("precios al consumidor")) %>%
  rename("inpc" = "indicadores de precios precios al consumidor f6/ (base segunda quincena de diciembre 2010 = 100)",
         "inpc_sub" = "indicadores de precios precios al consumidor subyacente f6/ (base segunda quincena de diciembre 2010 = 100)") %>%
  mutate(periodo = BIE_BIE20180126152150$Periodo,
         day = "01") %>%
  separate(periodo, into = c("year", "month"), sep = "\\/") %>%
  mutate(fecha = as_date(paste0(year, month, day)),
         inflacion  = (inpc/lag(inpc, 1) -1)*100) %>%
  filter(fecha > "2007-01-01")






```


# EBOOK ATISA
## Indicadores económicos de coyuntura (México)

El comportamiento de los indicadores más relevantes para el sector de la construcción a nivel nacional tuvieron un comportamiento al a baja, el Indicador del volumen físico de la cosntrucción tuvo un comportamiento a la baja, tanto en su componente cíclico y tendencial. 

Se observa así mismo que la inflación mensual medida a través del INPC(Índice Nacional de Precios al Consumidor) sigue una tendencia incremental. Principalmente en los meses de Octubre, Noviembre y Diciembre.


```{r fig.height=2, fig.width=3}

datos %>%
  ggplot(aes(fecha, constr_calend)) + 
  geom_line(colour = "#4f2584", size = 0.2) + 
  geom_smooth(method = "loess", size = 0.2) +
  theme_minimal() + 
  ggtitle("Índice del volumen físico de la construcción") +
  xlab(label = NULL) +
  ylab(label = "Índice") + 
  theme(plot.title = element_text(family = "mono", color = "#666666", face = "bold", size = 5)) +
  theme(axis.title = element_text(family = "mono", color = "#666666", size = 4), axis.text = element_text(size = 4))
  
```



```{r fig.height=2, fig.width=3}

datos %>% 
  ggplot(aes(fecha, constr_cicl)) + 
  geom_line(colour = "#4f2584", size = 0.2) +
  geom_smooth(method = "loess", size = 0.2) +
  theme_minimal() +
  ggtitle("Índice de valor físico de la construcción") +
  xlab(label = NULL) +
  theme(plot.title = element_text(family = "mono", color = "#666666", face = "bold", size = 5)) +
  theme(axis.title = element_text(family = "mono", color = "#666666", size = 4)) + 
  theme(axis.text = element_text(size = 4))


```


```{r fig.height=2, fig.width=3}

datos2 %>%
  ggplot(aes(fecha, inflacion)) + 
  geom_line(colour = "#4f2584", size = 0.2) + 
  geom_smooth(method = "loess", size = 0.2) + 
  theme_minimal() +
  ggtitle("Inflación mensual") + 
  xlab(label = NULL) + 
  theme(plot.title = element_text(family = "mono", color = "#666666", face = "bold", size = 5)) + 
  theme(axis.title = element_text(family = "mono", color = "#666666", face = "bold", size = 4)) +
  theme(axis.text = element_text(size = 4))


```



## Infraestructura comercial de México

```{r}
doing_db <- read_excel("C:/Users/pvelazquez/Google Drive/Sector Industrial en Tijuana/Bases de datos/Doing_business_world_bank.xlsx", col_types = c("text", "text", "skip", "numeric", "skip", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric",  "skip", "numeric", "skip", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "skip", "numeric", "skip", "numeric", "numeric", "numeric", "numeric", "numeric", "text",  "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "skip", "numeric", "skip", "numeric", "numeric", "skip", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "text", "text", "text", "text", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "skip", "numeric", "skip", "skip", "skip", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric", "skip", "numeric", "skip", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric","numeric", "numeric", "numeric"))
```

### Número de días para abrir un negocio

```{r}

doing_db %>%
  select("Starting a Business - Time - Men (days)", Economy) %>%
  rename("dias" = "Starting a Business - Time - Men (days)") %>%
  ggplot(aes(x = reorder(Economy, -dias), y = dias)) + 
  geom_col(aes(fill = -dias)) + 
  coord_flip() +
  xlab(label = "Número de días") + 
  ylab(label = "País") + 
  ggtitle("Numero de días para abrir un negocio") +
  theme_minimal() + 
  theme(legend.position = "none")
```

```{r}


propiedades_tijuana <- read_csv("propiedades_tijuana.csv", 
    na = "null")


propiedades_tijuana %>%
  filter(!estado %in% c("construccion", "planeado")) %>% 
  distinct() %>%
  mutate(area_total = sum(espacio_disponible)) %>%
  group_by(submercado) %>%
  mutate(area_submercado = sum(espacio_disponible)) %>%
  ungroup() %>%
  mutate(percent = area_submercado / area_total, submercado) %>%
  group_by(submercado, percent) %>%
  summarise() %>%
  ggplot(aes(x = reorder(submercado, -percent), y = percent)) + geom_col(aes(fill = -percent)) + 
    coord_flip() +
  ggtitle("Disponibilidad por submercado en Tijuana ft^2") +
  ylab(label = NULL) +
  xlab(label = "Sub-mercado") +
  theme_minimal() + 
  theme(legend.position = "none")


```


```{r}

propiedades_tijuana %>%
  filter(!estado %in% c("construccion", "planeado"), submercado %in% c("Insurgentes-El Aguila")) %>%
  select(nombre, espacio_disponible, precio_de_arrendamiento, corretaje_representativo, clase) %>%
  ggplot(aes(x = reorder(nombre, -espacio_disponible), y = espacio_disponible)) +
  geom_col(aes(fill = -espacio_disponible)) + 
  coord_flip() +
  ggtitle("Naves disponibles en sub-mercado Insurgentes-El Aguila") + 
  xlab(label = "Nombre de la Nave") +
  ylab(label = "Tamaño en pies Cuadrados" ) + 
  theme_minimal() + 
  theme(legend.position = "none")

```



```{r}

propiedades_tijuana %>%
  filter(!estado %in% c("construccion", "planeado"), submercado %in% c("La Mesa-Via Rapida")) %>%
  select(nombre, espacio_disponible, precio_de_arrendamiento, corretaje_representativo, clase) %>%
  distinct() %>%
  ggplot(aes(x = reorder(nombre, -espacio_disponible), y = espacio_disponible)) + 
  geom_col(aes(fill = -espacio_disponible)) + 
  coord_flip() + 
  ggtitle("Naves disponibles en sub-mercado La Mesa-Via Rápida") + 
  scale_y_continuous(breaks = c(0, 15000 ,30000, 45000, 75000, 100000, 125000, 150000), labels = c("0", "15k", "30k", "45k", "75k", "100k", "125k", "150k")) + 
  xlab(label = "Nombre de la nave") +
  theme_minimal() + 
  theme(legend.position = "none")

```




```{r}
propiedades_tijuana %>%
  filter(!estado %in% c("construccion", "planeado"), submercado %in% c("El Florido-Boulevard 2000")) %>%
  distinct() %>%
  ggplot(aes(x = reorder(nombre, -espacio_disponible), y = espacio_disponible)) + 
  geom_col(aes(fill = -espacio_disponible)) +
  coord_flip() + 
  ggtitle("Naves disponibles en submrecado El florido-Boulevard 2000") + 
  xlab(label = "Nombre de la nave") + 
  scale_y_continuous(quote(ft ^ 2), labels = c("0", "50k", "100k", "150k", "200k")) +
  theme_minimal() + 
  theme(legend.position = "none")

```

```{r}
propiedades_tijuana %>%
  filter(!estado %in% c("construccion", "planeado")) %>%
  distinct() %>%
  ggplot(aes(x = reorder(nombre, -espacio_disponible), y = espacio_disponible)) + 
  geom_col(aes(fill = espacio_disponible)) + 
  facet_grid(~submercado) + 
  coord_flip() + 
  ggtitle("Naves disponibles por submercado en Tijuana") + 
  scale_y_continuous(quote(ft ^ 2), breaks = c(0, 50000, 100000, 150000, 200000), labels = c("0", "50k", "100k", "150k", "200k")) +
  xlab(label = NULL) +
  theme_minimal() + 
  theme(legend.position = "none", axis.title = element_text(family = "mono", color = "#666666", size = 4), axis.text = element_text(size = 4))

```






















